<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <style>
        body {
  width: 80vw;
  height: 80vh;
  margin: 0;
  overflow: hidden;
}
    </style>
    <meta charset="UTF-8">
    <title>Home</title>
</head>
<body id ='canvas'>
    <!---
    <h1 th:text="${message}"></h1>
    <img th:src="@{/images/example.png}" alt="Example Image">

    -->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script type="module" th:inline="javascript">
    import {
      Camera,
      DirectionalLight,
      Color,
      Material,
      PointLight,
      WebGLRenderer,
      Scene,
      PerspectiveCamera,
      Texture,
      Raycaster,
      AmbientLight,
    } from 'https://unpkg.com/three@0.120.1/build/three.module.js'
    import { OrbitControls } from 'https://unpkg.com/three@0.120.1/examples/jsm/controls/OrbitControls.js'
    import { GLTFLoader } from 'https://unpkg.com/three@0.120.1/examples/jsm/loaders/GLTFLoader.js'

    let scene, camera, renderer;
 function init() {

      scene = new Scene();
      scene.background = new Color(0xdddddd);

      camera = new PerspectiveCamera(40,window.innerWidth/window.innerHeight,1,5000);
      camera.rotation.y = 45/180*Math.PI;
      camera.position.x = 8;
      camera.position.y = 1;
      camera.position.z = 10;

      const hlight = new AmbientLight (0x404040,1);
      scene.add(hlight);

      const directionalLight = new DirectionalLight(0xffffff,1);
      directionalLight.position.set(0,1,0);
      directionalLight.castShadow = true;
      scene.add(directionalLight);
      const light = new PointLight(0xc4c4c4,1);
      light.position.set(0,300,500);
      scene.add(light);
      const light2 = new PointLight(0xc4c4c4,1);
      light2.position.set(500,100,0);
      scene.add(light2);
      const light3 = new PointLight(0xc4c4c4,1);
      light3.position.set(0,100,-500);
      scene.add(light3);
      const light4 = new PointLight(0xc4c4c4,1);
      light4.position.set(-500,300,500);
      scene.add(light4);

      renderer = new WebGLRenderer({antialias:true});
      renderer.setSize(window.innerWidth,window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const controls = new OrbitControls(camera, renderer.domElement);
      // controls.addEventListener('change', renderer);
      const raycaster = new THREE.Raycaster();
const pointer = new THREE.Vector2();
      let loader = new GLTFLoader();
      loader.load('/3d/scene.gltf', function(gltf){
        const car = gltf.scene.children[0];
        console.log('car: ', car);
        car.scale.set(0.5,0.5,0.5);
   
        scene.add(car);

                        // Create a temperature bar geometry
            const barGeometry = new THREE.BoxGeometry(10, 50, 10); // Customize the dimensions as needed

        // Create a material for the temperature bar
        const barMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 }); // Customize the color as needed

        // Create a mesh using the bar geometry and material
        const temperatureBar = new THREE.Mesh(barGeometry, barMaterial);

        // Set the position of the temperature bar
        temperatureBar.position.set(50, 50, -10); // Customize the position as needed

        // Add the temperature bar to the scene
        scene.add(temperatureBar);


        // Create a texture for the text
const canvas = document.createElement('canvas');
const context = canvas.getContext('2d');
context.font = 'Bold 30px Arial';
context.fillStyle = '#ffffff'; // Customize the text color
var message = /*[[${message}]]*/ "";
context.fillText(message, 0, 40);

const texture = new THREE.CanvasTexture(canvas);
texture.needsUpdate = true;

// Create a material using the text texture
const material = new THREE.SpriteMaterial({ map: texture });

// Create a sprite using the material
const sprite = new THREE.Sprite(material);
sprite.scale.set(100, 250, 100); // Customize the scale of the sprite

// Set the position of the sprite
sprite.position.set(0, 0, 0); // Customize the position of the sprite

// Add the sprite to the scene
scene.add(sprite);
// Create a dot geometry and material
const dotGeometry = new THREE.SphereGeometry(0.1, 32, 32);
const dotMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 }); // Customize the dot color

// Create a dot mesh
const dotMesh = new THREE.Mesh(dotGeometry, dotMaterial);
dotMesh.position.set(1, 1, 1); // Customize the dot position

// Add the dot mesh to the scene
scene.add(dotMesh);

// Set up the raycaster


// Attach event listeners
window.addEventListener('mousemove', onMouseMove, false);
window.addEventListener('click', onMouseClick, false);
        animate();
      });


    }

    
    function animate() {
      renderer.render(scene,camera);
      requestAnimationFrame(animate);
      

    }


    // Handle mouse move event
function onMouseMove(event) {
  const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
  // Calculate normalized device coordinates (-1 to +1) for the mouse position
  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
}

// Handle mouse click event
function onMouseClick(event) {
  // Update the picking ray with the camera and mouse position
  const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
  raycaster.setFromCamera(mouse, camera);

  // Check for intersections
  const intersects = raycaster.intersectObjects(scene.children, true);

  if (intersects.length > 0) {
    console.log('Intersection:', intersects[0].object);
    
    // Do something with the intersected object
    // Check if any coordinate of the intersection point is greater than 50

  }
}
    
    init();
  </script>

  </div>
</body>

</html>
